<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="reviewMapper"> 
		
	
	<select id="reviewSelectList" resultType="reviewDto">
		SELECT * FROM review
	</select>
	
	<select id="reviewSelectSearchList" resultType="reviewDto">
		SELECT * FROM review WHERE title LIKE #{search}
	</select>
	
	<select id="reviewResultScore" parameterType="int" resultType="double">
		SELECT AVG(score) AS average_score FROM review WHERE restaurant_id = #{restaurant_id}
	</select>	
	
	<select id="reviewOneScore" parameterType="reviewDto" resultType="int">
		SELECT COUNT(*) FROM review WHERE restaurant_id = #{restaurant_id} and score = #{score}
	</select>
	
	<!-- 전체 리뷰의 수 -->
	<select id="reviewCount" parameterType="int" resultType="int">
		SELECT COUNT(*) FROM review WHERE restaurant_id = #{restaurant_id}
	</select>
	
	<!-- 제목으로 검색한 리뷰의 수 -->
	<select id="reviewSearchCount" parameterType="reviewDto" resultType="int">
		SELECT COUNT(*) FROM review WHERE restaurant_id = #{restaurant_id} and title LIKE #{search}
	</select>
	
	<select id="reviewDetail" resultType="reviewDto">
		SELECT * FROM review where id = #{id}
	</select>
	
	<insert id="insertReview" parameterType="reviewDto">
		INSERT INTO review(userid, nickname, title, detail, score, restaurant_id, imnum) VALUES(#{userid}, #{nickname}, #{title}, #{detail}, #{score}, #{restaurant_id}, #{imnum})
	</insert>
	
	<update id="ratingReview" parameterType="reviewDto">
		UPDATE review SET rating = rating + 1 WHERE id = #{id}
	</update>
	
	<update id="reviewHitUp" parameterType="reviewDto">
		UPDATE review SET hits = hits + 1 WHERE id = #{id}
	</update>
	
	
	
 </mapper>


